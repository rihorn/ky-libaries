// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.10/esri/copyright.txt for details.

define(["require","exports","dojo/Deferred","../../kernel","../kernel","../languageUtils","../featureset/support/shared","./centroid","../../geometry/Extent","../../geometry/Geometry","../../geometry/geometryEngineAsync","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/jsonUtils"],function(n,e,t,r,o,u,i,a,l,c,f,s,d,g,m,y){function h(n){return 0===r.version.indexOf("4.")?g.fromExtent(n):new g({spatialReference:n.spatialReference,rings:[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]]})}function w(n){if(u.pcCheck(n,2,2),n[0]instanceof c&&n[1]instanceof c);else if(n[0]instanceof c&&null===n[1]);else if(n[1]instanceof c&&null===n[0]);else if(null!==n[0]||null!==n[1])throw new Error("Illegal Argument")}function A(n){"async"===n.mode&&(n.functions.disjoint=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=u.autoCastFeatureToGeometry(t),w(t),null===t[0]||null===t[1]||f.disjoint(t[0],t[1])})},n.functions.intersects=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=u.autoCastFeatureToGeometry(t),w(t),null!==t[0]&&null!==t[1]&&f.intersects(t[0],t[1])})},n.functions.touches=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=u.autoCastFeatureToGeometry(t),w(t),null!==t[0]&&null!==t[1]&&f.touches(t[0],t[1])})},n.functions.crosses=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=u.autoCastFeatureToGeometry(t),w(t),null!==t[0]&&null!==t[1]&&f.crosses(t[0],t[1])})},n.functions.within=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=u.autoCastFeatureToGeometry(t),w(t),null!==t[0]&&null!==t[1]&&f.within(t[0],t[1])})},n.functions.contains=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=u.autoCastFeatureToGeometry(t),w(t),null!==t[0]&&null!==t[1]&&f.contains(t[0],t[1])})},n.functions.overlaps=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=u.autoCastFeatureToGeometry(t),w(t),null!==t[0]&&null!==t[1]&&f.overlaps(t[0],t[1])})},n.functions.equals=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return u.pcCheck(t,2,2),t[0]===t[1]||(t[0]instanceof c&&t[1]instanceof c?f.equals(t[0],t[1]):!(!u.isDate(t[0])||!u.isDate(t[1]))&&t[0].getTime()===t[1].getTime())})},n.functions.relate=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,3,3),t[0]instanceof c&&t[1]instanceof c)return f.relate(t[0],t[1],u.toString(t[2]));if(t[0]instanceof c&&null===t[1])return!1;if(t[1]instanceof c&&null===t[0])return!1;if(null===t[0]&&null===t[1])return!1;throw new Error("Illegal Argument")})},n.functions.intersection=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=u.autoCastFeatureToGeometry(t),w(t),null===t[0]||null===t[1]?null:f.intersect(t[0],t[1])})},n.functions.union=function(e,t){return n.standardFunctionAsync(e,t,function(n,t,r){r=u.autoCastFeatureToGeometry(r);var o=[];if(0===r.length)throw new Error("Function called with wrong number of Parameters");if(1===r.length)if(u.isArray(r[0])){for(var a=u.autoCastFeatureToGeometry(r[0]),l=0;l<a.length;l++)if(null!==a[l]){if(!(a[l]instanceof c))throw new Error("Illegal Argument");o.push(a[l])}}else{if(!u.isImmutableArray(r[0])){if(r[0]instanceof c)return u.fixSpatialReference(i.cloneGeometry(r[0]),e.spatialReference);if(null===r[0])return null;throw new Error("Illegal Argument")}for(var s=u.autoCastFeatureToGeometry(r[0].toArray()),l=0;l<s.length;l++)if(null!==s[l]){if(!(s[l]instanceof c))throw new Error("Illegal Argument");o.push(s[l])}}else for(var l=0;l<r.length;l++)if(null!==r[l]){if(!(r[l]instanceof c))throw new Error("Illegal Argument");o.push(r[l])}return 0===o.length?null:f.union(o)})},n.functions.difference=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=u.autoCastFeatureToGeometry(t),w(t),null!==t[0]&&null===t[1]?i.cloneGeometry(t[0]):null===t[0]?null:f.difference(t[0],t[1])})},n.functions.symmetricdifference=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=u.autoCastFeatureToGeometry(t),w(t),null===t[0]&&null===t[1]?null:null===t[0]?i.cloneGeometry(t[1]):null===t[1]?i.cloneGeometry(t[0]):f.symmetricDifference(t[0],t[1])})},n.functions.clip=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,2,2),!(t[1]instanceof l)&&null!==t[1])throw new Error("Illegal Argument");if(null===t[0])return null;if(!(t[0]instanceof c))throw new Error("Illegal Argument");return null===t[1]?null:f.clip(t[0],t[1])})},n.functions.cut=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,2,2),!(t[1]instanceof m)&&null!==t[1])throw new Error("Illegal Argument");if(null===t[0])return[];if(!(t[0]instanceof c))throw new Error("Illegal Argument");return null===t[1]?[i.cloneGeometry(t[0])]:f.cut(t[0],t[1])})},n.functions.area=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,1,2),null===t[0])return 0;if(!(t[0]instanceof c))throw new Error("Illegal Argument");return f.planarArea(t[0],o.convertSquareUnitsToCode(u.defaultUndefined(t[1],-1)))})},n.functions.areageodetic=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,1,2),null===t[0])return 0;if(!(t[0]instanceof c))throw new Error("Illegal Argument");return f.geodesicArea(t[0],o.convertSquareUnitsToCode(u.defaultUndefined(t[1],-1)))})},n.functions.length=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,1,2),null===t[0])return 0;if(!(t[0]instanceof c))throw new Error("Illegal Argument");return f.planarLength(t[0],o.convertLinearUnitsToCode(u.defaultUndefined(t[1],-1)))})},n.functions.lengthgeodetic=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,1,2),null===t[0])return 0;if(!(t[0]instanceof c))throw new Error("Illegal Argument");return f.geodesicLength(t[0],o.convertLinearUnitsToCode(u.defaultUndefined(t[1],-1)))})},n.functions.distance=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,2,3),!(t[0]instanceof c))throw new Error("Illegal Argument");if(!(t[1]instanceof c))throw new Error("Illegal Argument");return f.distance(t[0],t[1],o.convertLinearUnitsToCode(u.defaultUndefined(t[2],-1)))})},n.functions.densify=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof c))throw new Error("Illegal Argument");var r=u.toNumber(t[1]);if(isNaN(r))throw new Error("Illegal Argument");if(r<=0)throw new Error("Illegal Argument");return t[0]instanceof g||t[0]instanceof m?f.densify(t[0],r,o.convertLinearUnitsToCode(u.defaultUndefined(t[2],-1))):t[0]instanceof l?f.densify(h(t[0]),r,o.convertLinearUnitsToCode(u.defaultUndefined(t[2],-1))):t[0]})},n.functions.densifygeodetic=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof c))throw new Error("Illegal Argument");var r=u.toNumber(t[1]);if(isNaN(r))throw new Error("Illegal Argument");if(r<=0)throw new Error("Illegal Argument");return t[0]instanceof g||t[0]instanceof m?f.geodesicDensify(t[0],r,o.convertLinearUnitsToCode(u.defaultUndefined(t[2],-1))):t[0]instanceof l?f.geodesicDensify(h(t[0]),r,o.convertLinearUnitsToCode(u.defaultUndefined(t[2],-1))):t[0]})},n.functions.generalize=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,2,4),null===t[0])return null;if(!(t[0]instanceof c))throw new Error("Illegal Argument");var r=u.toNumber(t[1]);if(isNaN(r))throw new Error("Illegal Argument");return f.generalize(t[0],r,u.toBoolean(u.defaultUndefined(t[2],!0)),o.convertLinearUnitsToCode(u.defaultUndefined(t[3],-1)))})},n.functions.buffer=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof c))throw new Error("Illegal Argument");var r=u.toNumber(t[1]);if(isNaN(r))throw new Error("Illegal Argument");return 0===r?i.cloneGeometry(t[0]):f.buffer(t[0],r,o.convertLinearUnitsToCode(u.defaultUndefined(t[2],-1)))})},n.functions.buffergeodetic=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof c))throw new Error("Illegal Argument");var r=u.toNumber(t[1]);if(isNaN(r))throw new Error("Illegal Argument");return 0===r?i.cloneGeometry(t[0]):f.geodesicBuffer(t[0],r,o.convertLinearUnitsToCode(u.defaultUndefined(t[2],-1)))})},n.functions.offset=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,2,6),null===t[0])return null;if(!(t[0]instanceof g||t[0]instanceof m))throw new Error("Illegal Argument");var r=u.toNumber(t[1]);if(isNaN(r))throw new Error("Illegal Argument");var i=u.toNumber(u.defaultUndefined(t[4],10));if(isNaN(i))throw new Error("Illegal Argument");var a=u.toNumber(u.defaultUndefined(t[5],0));if(isNaN(a))throw new Error("Illegal Argument");return f.offset(t[0],r,o.convertLinearUnitsToCode(u.defaultUndefined(t[2],-1)),u.toString(u.defaultUndefined(t[3],"round")).toLowerCase(),i,a)})},n.functions.rotate=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,2,3);var r=t[0];if(null===r)return null;if(!(r instanceof c))throw new Error("Illegal Argument");r instanceof l&&(r=g.fromExtent(r));var o=u.toNumber(t[1]);if(isNaN(o))throw new Error("Illegal Argument");var i=u.defaultUndefined(t[2],null);if(null===i)return f.rotate(r,o);if(i instanceof d)return f.rotate(r,o,i);throw new Error("Illegal Argument")})},n.functions.centroid=function(e,t){return n.standardFunctionAsync(e,t,function(n,t,r){if(r=u.autoCastFeatureToGeometry(r),u.pcCheck(r,1,1),null===r[0])return null;if(!(r[0]instanceof c))throw new Error("Illegal Argument");return r[0]instanceof d?u.fixSpatialReference(i.cloneGeometry(r[0]),e.spatialReference):r[0]instanceof g?r[0].centroid:r[0]instanceof m?a.centroidPolyline(r[0]):r[0]instanceof s?a.centroidMultiPoint(r[0]):r[0]instanceof l?r[0].center:null})},n.functions.multiparttosinglepart=function(e,r){return n.standardFunctionAsync(e,r,function(n,r,a){a=u.autoCastFeatureToGeometry(a),u.pcCheck(a,1,1);var h=[];if(null===a[0])return null;if(!(a[0]instanceof c))throw new Error("Illegal Argument");if(a[0]instanceof d)return[u.fixSpatialReference(i.cloneGeometry(a[0]),e.spatialReference)];if(a[0]instanceof l)return[u.fixSpatialReference(i.cloneGeometry(a[0]),e.spatialReference)];var w=new t;return f.simplify(a[0]).then(o.callback(function(n){if(n instanceof g){for(var t=[],r=[],o=0;o<n.rings.length;o++)if(n.isClockwise(n.rings[o])){var l=y.fromJSON({rings:[n.rings[o]],hasZ:!0===n.hasZ,hazM:!0===n.hasM,spatialReference:n.spatialReference.toJSON()});t.push(l)}else r.push({ring:n.rings[o],pt:n.getPoint(o,0)});for(var c=0;c<r.length;c++)for(var f=0;f<t.length;f++)if(t[f].contains(r[c].pt)){t[f].addRing(r[c].ring);break}w.resolve(t)}else if(n instanceof m){for(var d=[],o=0;o<n.paths.length;o++){var A=y.fromJSON({paths:[n.paths[o]],hasZ:!0===n.hasZ,hazM:!0===n.hasM,spatialReference:n.spatialReference.toJSON()});d.push(A)}w.resolve(d)}else if(a[0]instanceof s){for(var p=u.fixSpatialReference(i.cloneGeometry(a[0]),e.spatialReference),o=0;o<p.points.length;o++)h.push(p.getPoint(o));w.resolve(h)}else w.resolve(null)},w),o.errback(w)),w.promise})},n.functions.issimple=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,1,1),null===t[0])return!0;if(t[0]instanceof c)return f.isSimple(t[0]);throw new Error("Illegal Argument")})},n.functions.simplify=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=u.autoCastFeatureToGeometry(t),u.pcCheck(t,1,1),null===t[0])return null;if(t[0]instanceof c)return f.simplify(t[0]);throw new Error("Illegal Argument")})})}Object.defineProperty(e,"__esModule",{value:!0}),e.registerFunctions=A});