// COPYRIGHT © 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.10/esri/copyright.txt for details.

define(["require","exports","dojo/number","../moment","./FunctionWrapper","./ImmutableArray","./ImmutablePathArray","./ImmutablePointArray","../geometry/Extent","../geometry/Geometry","../geometry/Multipoint","../geometry/Point","../geometry/Polygon","../geometry/Polyline"],function(e,n,t,r,i,u,o,a,l,f,c,s,d,m){function y(e,n,t){if(""===n)return e;if(null===n)return e;if(void 0===n)return e;if(n===t)return e;if(n===t)return e;do{e=e.replace(n,t)}while(-1!==e.indexOf(n));return e}function g(e){return e instanceof Y||e instanceof i||e instanceof $}function p(e){return!!x(e)||(!!S(e)||(!!C(e)||(!!h(e)||(null===e||(e===n.voidOperation||"number"==typeof e)))))}function v(e,n){return void 0===e?n:e}function x(e){return"string"==typeof e||e instanceof String}function h(e){return"boolean"==typeof e}function S(e){return"number"==typeof e}function N(e){return e instanceof Array}function O(e){return e&&e.declaredRootClass&&"esri.arcade.featureset.support.FeatureSet"===e.declaredRootClass}function T(e){return e&&e.declaredRootClass&&"esri.arcade.featureSetCollection"===e.declaredRootClass}function b(e){return e instanceof u}function C(e){return e instanceof Date}function R(e,n,t){if(e.length<n||e.length>t)throw new Error("Function called with wrong number of Parameters")}function F(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===n?t:3&t|8).toString(16)})}function I(e,n){return!1===isNaN(e)?void 0===n||null===n||""===n?e.toString():(n=y(n,"‰",""),n=y(n,"¤",""),t.format(e,{pattern:n})):e.toString()}function _(e,n){var t=r(e);return void 0===n||null===n||""===n?t.format():t.format(j(n))}function j(e){return e.replace(/(LTS)|L|l/g,function(e){return"["+e+"]"})}function D(e,n,t){switch(t){case">":return e>n;case"<":return e<n;case">=":return e>=n;case"<=":return e<=n}return!1}function k(e,t,r){if(null===e){if(null===t||t===n.voidOperation)return D(null,null,r);if(S(t))return D(0,t,r);if(x(t))return D(0,P(t),r);if(h(t))return D(0,P(t),r);if(C(t))return D(0,t.getTime(),r)}if(e===n.voidOperation){if(null===t||t===n.voidOperation)return D(null,null,r);if(S(t))return D(0,t,r);if(x(t))return D(0,P(t),r);if(h(t))return D(0,P(t),r);if(C(t))return D(0,t.getTime(),r)}else if(S(e)){if(S(t))return D(e,t,r);if(h(t))return D(e,P(t),r);if(null===t||t===n.voidOperation)return D(e,0,r);if(x(t))return D(e,P(t),r);if(C(t))return D(e,t.getTime(),r)}else if(x(e)){if(x(t))return D(J(e),J(t),r);if(C(t))return D(P(e),t.getTime(),r);if(S(t))return D(P(e),t,r);if(null===t||t===n.voidOperation)return D(P(e),0,r);if(h(t))return D(P(e),P(t),r)}else if(C(e)){if(C(t))return D(e,t,r);if(null===t||t===n.voidOperation)return D(e.getTime(),0,r);if(S(t))return D(e.getTime(),t,r);if(h(t))return D(e.getTime(),P(t),r);if(x(t))return D(e.getTime(),P(t),r)}else if(h(e)){if(h(t))return D(e,t,r);if(S(t))return D(P(e),P(t),r);if(C(t))return D(P(e),t.getTime(),r);if(null===t||t===n.voidOperation)return D(P(e),0,r);if(x(t))return D(P(e),P(t),r)}return!!w(e,t)&&("<="===r||">="===r)}function w(e,t){if(e===t)return!0;if(null===e&&t===n.voidOperation||null===t&&e===n.voidOperation)return!0;if(C(e)&&C(t))return e.getTime()===t.getTime();if(e instanceof o)return e.equalityTest(t);if(e instanceof a)return e.equalityTest(t);if(e instanceof s&&t instanceof s){var r=void 0,i=void 0;if(r=e.cache._arcadeCacheId,i=t.cache._arcadeCacheId,void 0!==r&&null!==r)return r===i}if(void 0!==e&&void 0!==t&&null!==e&&null!==t&&"object"==typeof e&&"object"==typeof t){if(e._arcadeCacheId===t._arcadeCacheId&&void 0!==e._arcadeCacheId&&null!==e._arcadeCacheId)return!0;if(e._underlyingGraphic===t._underlyingGraphic&&void 0!==e._underlyingGraphic&&null!==e._underlyingGraphic)return!0}return!1}function J(e,t){if(x(e))return e;if(null===e)return"";if(S(e))return I(e,t);if(h(e))return e.toString();if(C(e))return _(e,t);if(e instanceof f)return JSON.stringify(e.toJSON());if(N(e)){for(var r=[],i=0;i<e.length;i++)r[i]=z(e[i]);return"["+r.join(",")+"]"}if(e instanceof u){for(var r=[],i=0;i<e.length();i++)r[i]=z(e.get(i));return"["+r.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():g(e)?"object, Function":(n.voidOperation,"")}function A(e){var n=[];if(!1===N(e))return null;if(e instanceof u){for(var t=0;t<e.length();t++)n[t]=P(e.get(t));return n}for(var t=0;t<e.length;t++)n[t]=P(e[t]);return n}function E(e,t){if(x(e))return e;if(null===e)return"";if(S(e))return I(e,t);if(h(e))return e.toString();if(C(e))return _(e,t);if(e instanceof f)return e instanceof l?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+W(e.spatialReference)+"}":W(e.toJSON(),function(e,n){return e.key===n.key?0:"spatialReference"===e.key?1:"spatialReference"===n.key?-1:e.key<n.key?-1:e.key>n.key?1:0});if(N(e)){for(var r=[],i=0;i<e.length;i++)r[i]=z(e[i]);return"["+r.join(",")+"]"}if(e instanceof u){for(var r=[],i=0;i<e.length();i++)r[i]=z(e.get(i));return"["+r.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():g(e)?"object, Function":(n.voidOperation,"")}function z(e){if(null===e)return"null";if(h(e)||S(e)||x(e))return JSON.stringify(e);if(e instanceof f)return E(e);if(e instanceof u)return E(e);if(e instanceof Array)return E(e);if(e instanceof Date)return JSON.stringify(_(e,""));if(null!==e&&"object"==typeof e){if(void 0!==e.castToText)return e.castToText()}else if(e===n.voidOperation)return"null";return"null"}function P(e,r){return S(e)?e:null===e?0:""===e?0:C(e)?NaN:h(e)?e?1:0:N(e)?NaN:""===e?NaN:void 0===e?NaN:void 0!==r&&x(e)?(r=y(r,"‰",""),r=y(r,"¤",""),t.parse(e,{pattern:r})):e===n.voidOperation?0:Number(e)}function V(e,n){if(C(e))return e;if(x(e)){var t=r(e,[void 0===n||null===n||""===n?r.ISO_8601:n]);if(t.isValid())return t.toDate()}return null}function G(e,n){if(C(e))return r(e);if(x(e)){var t=r(e,[void 0===n||null===n||""===n?r.ISO_8601:n]);if(t.isValid())return t}return null}function M(e){return h(e)?e:x(e)?"true"===(e=e.toLowerCase()):!!S(e)&&(0!==e&&!isNaN(e))}function L(e,n){return null===e||void 0===e?null:(null!==e.spatialReference&&void 0!==e.spatialReference||(e.spatialReference=n),e)}function q(e){return null===e?null:e instanceof s?"NaN"===e.x||null===e.x||isNaN(e.x)?null:e:e instanceof d?0===e.rings.length?null:e:e instanceof m?0===e.paths.length?null:e:e instanceof c?0===e.points.length?null:e:e instanceof l?"NaN"===e.xmin||null===e.xmin||isNaN(e.xmin)?null:e:null}function U(e,n){if(!e)return null;if(!e.domain)return null;var t=null;n="string"===e.field.type||"esriFieldTypeString"===e.field.type?J(n):P(n);for(var r=0;r<e.domain.codedValues.length;r++){var i=e.domain.codedValues[r];i.code===n&&(t=i)}return null===t?null:t.name}function B(e,n){if(!e)return null;if(!e.domain)return null;var t=null;n=J(n);for(var r=0;r<e.domain.codedValues.length;r++){var i=e.domain.codedValues[r];i.name===n&&(t=i)}return null===t?null:t.code}function Z(e,n,t,r){if(void 0===t&&(t=null),!n)return null;if(!n.fields)return null;for(var i=null,u=0;u<n.fields.length;u++){var o=n.fields[u];o.name.toLowerCase()===e.toString().toLowerCase()&&(i=o)}if(null===i)return null;var a,l;return r||(r=t&&n.typeIdField&&t._field(n.typeIdField)),null!=r&&n.types.some(function(e){return e.id===r&&(a=e.domains&&e.domains[i.name],a&&"inherited"===a.type&&(a=K(i.name,n),l=!0),!0)}),l||a||(a=K(e,n)),{field:i,domain:a}}function K(e,n){var t;return n.fields.some(function(n){return n.name===e&&(t=n.domain),!!t}),t}function W(e,n){n||(n={}),"function"==typeof n&&(n={cmp:n});var t="boolean"==typeof n.cycles&&n.cycles,r=n.cmp&&function(e){return function(n){return function(t,r){var i={key:t,value:n[t]},u={key:r,value:n[r]};return e(i,u)}}}(n.cmp),i=[];return function e(n){if(n&&n.toJSON&&"function"==typeof n.toJSON&&(n=n.toJSON()),void 0!==n){if("number"==typeof n)return isFinite(n)?""+n:"null";if("object"!=typeof n)return JSON.stringify(n);var u,o;if(Array.isArray(n)){for(o="[",u=0;u<n.length;u++)u&&(o+=","),o+=e(n[u])||"null";return o+"]"}if(null===n)return"null";if(-1!==i.indexOf(n)){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=i.push(n)-1,l=Object.keys(n).sort(r&&r(n));for(o="",u=0;u<l.length;u++){var f=l[u],c=e(n[f]);c&&(o&&(o+=","),o+=JSON.stringify(f)+":"+c)}return i.splice(a,1),"{"+o+"}"}}(e)}function H(e){if(null===e)return null;for(var n=[],t=0,r=e;t<r.length;t++){var i=r[t];i&&i.declaredClass&&"esri.arcade.Feature"===i.declaredClass?n.push(i.geometry()):n.push(i)}return n}Object.defineProperty(n,"__esModule",{value:!0});var Q=function(){function e(e){this.value=e}return e}();n.ReturnResultE=Q;var X=function(){function e(e){this.value=e}return e}();n.ImplicitResultE=X;var Y=function(){function e(e){this.fn=e}return e}();n.NativeFunctionE=Y;var $=function(){function e(e){this.fn=e}return e}();n.SizzleFunctionE=$,n.NativeFunction=Y,n.ImplicitResult=X,n.ReturnResult=Q,n.SizzleFunction=$,n.voidOperation={type:"VOID"},n.breakResult={type:"BREAK"},n.continueResult={type:"CONTINUE"},n.multiReplace=y,n.isFunctionParameter=g,n.isSimpleType=p,n.defaultUndefined=v,n.isString=x,n.isBoolean=h,n.isNumber=S,n.isArray=N,n.isFeatureSet=O,n.isFeatureSetCollection=T,n.isImmutableArray=b,n.isDate=C,n.pcCheck=R,n.generateUUID=F,n.formatNumber=I,n.formatDate=_,n.standardiseDateFormat=j,n.greaterThanLessThan=k,n.equalityTest=w,n.toString=J,n.toNumberArray=A,n.toStringExplicit=E,n.toNumber=P,n.toDate=V,n.toDateM=G,n.toBoolean=M,n.fixSpatialReference=L,n.fixNullGeometry=q,n.getDomainValue=U,n.getDomainCode=B,n.getDomain=Z,n.stableStringify=W,n.autoCastFeatureToGeometry=H});