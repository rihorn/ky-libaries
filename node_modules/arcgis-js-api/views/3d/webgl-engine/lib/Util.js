// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.10/esri/copyright.txt for details.

define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../../support/mathUtils"],function(t,n,r,e){function a(t,n){if(!t){var r=new Error("dummy");throw r.stack&&console.log(r.stack),new G(n)}}function o(t,n){t||(console.log("Verify failed: "+n),console.log(new Error("dummy").stack))}function c(t){return e.clamp(Math.round(32767*t),-32767,32767)}function i(t,n){var r=Math.abs(t[0]),e=Math.abs(t[1]),a=Math.abs(t[2]),o=1/(r+e+a),c=r*o,i=e*o,u=Math.min(t[2]*o,0);n[0]=(t[0]<0?-1:1)*(c-u),n[1]=(t[1]<0?-1:1)*(i-u)}function u(t,n){return void 0===t?n:t}function f(t){return t=Math.floor(t),[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]}function v(t){return"0x"+((e.clamp(Math.round(255*t[0]),0,255)<<16)+(e.clamp(Math.round(255*t[1]),0,255)<<8)+e.clamp(Math.round(255*t[2]),0,255)).toString(16)}function s(t){var n=t.toString(16);return"00000000".substr(0,8-n.length)+n}function l(t,n,e,a,o,c,i,u,f){void 0===f&&(f=r.vec3f64.create());var v=a[i]-e[c],s=a[i+1]-e[c+1],l=a[i+2]-e[c+2],M=o[u]-e[c],h=o[u+1]-e[c+1],d=o[u+2]-e[c+2],m=n[1]*d-h*n[2],p=n[2]*M-d*n[0],g=n[0]*h-M*n[1],x=v*m+s*p+l*g;if(x>-1e-5&&x<1e-5)return!1;var y=1/x,O=t[0]-e[c],b=t[1]-e[c+1],A=t[2]-e[c+2];if(f[1]=y*(O*m+b*p+A*g),f[1]<0||f[1]>1)return!1;var E=b*l-s*A,S=A*v-l*O,I=O*s-v*b;return f[2]=y*(n[0]*E+n[1]*S+n[2]*I),!(f[2]<0||f[1]+f[2]>1)&&(f[0]=y*(M*E+h*S+d*I),!0)}function M(t,n,r,e){var a,o=(r[0]-t[0])/n[0],c=(e[0]-t[0])/n[0];o>c&&(a=o,o=c,c=a);var i=(r[1]-t[1])/n[1],u=(e[1]-t[1])/n[1];if(i>u&&(a=i,i=u,u=a),o>u||i>c)return!1;i>o&&(o=i),u<c&&(c=u);var f=(r[2]-t[2])/n[2],v=(e[2]-t[2])/n[2];return f>v&&(a=f,f=v,v=a),!(o>v||f>c)&&(v<c&&(c=v),!(c<0))}function h(t,n,e,a,o,c){void 0===c&&(c=r.vec2f64.create());var i=(a[o]-e[o])*(n[0]-t[0])-(a[0]-e[0])*(n[o]-t[o]),u=(a[0]-e[0])*(t[o]-e[o])-(a[o]-e[o])*(t[0]-e[0]);if(0===i)return!1;var f=u/i;return c[0]=t[0]+f*(n[0]-t[0]),c[1]=t[o]+f*(n[o]-t[o]),!0}function d(t,n,e,o,c){c||(c=t),q[0]=t[0],q[1]=t[1],q[2]=t[2],q[3]=1,r.vec4.transformMat4(q,q,n),c.length>2&&(c[2]=-q[2]),r.vec4.transformMat4(q,q,e),a(0!==q[3]),c[0]=q[0]/q[3],c[1]=q[1]/q[3],c[2]=q[2]/q[3],c[0]=(.5*c[0]+.5)*o[2]+o[0],c[1]=(.5*c[1]+.5)*o[3]+o[1]}function m(t){for(var n in t)return n}function p(t){return t[m(t)]}function g(t){for(var n in t)return!1;return!0}function x(t,n){return Math.log(t)/Math.log(n)}function y(t,n){t[12]=n[0],t[13]=n[1],t[14]=n[2]}function O(t,n,r,e){t[12]=n,t[13]=r,t[14]=e}function b(t,n){return void 0===n&&(n=r.vec3f64.create()),n[0]=t[12],n[1]=t[13],n[2]=t[14],n}function A(t,n){return t=r.mat4.identity(t),y(t,n),t}function E(t){return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&1===t[15]}function S(t,n,r){return 2*Math.atan(r*Math.tan(.5*t)/n)}function I(t,n,r){return 2*Math.atan(n*Math.tan(.5*t)/r)}function N(t,n,r){return 2*Math.atan(Math.sqrt(n*n+r*r)*Math.tan(.5*t)/n)}function R(t,n,r){return 2*Math.atan(Math.sqrt(n*n+r*r)*Math.tan(.5*t)/r)}function T(t,n,r){return 2*Math.atan(n*Math.tan(.5*t)/Math.sqrt(n*n+r*r))}function C(t,n,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(n*n+r*r))}function L(t,n,a){var o=V,c=F,i=X,u=B,f=D,v=w;o[0]=n[0]-t[0],o[1]=n[1]-t[1],c[0]=a[0]-t[0],c[1]=a[1]-t[1],i[0]=a[0],i[1]=a[1];var s=r.vec2.dot(c,o),l=r.vec2.dot(o,o),M=e.clamp(s/l,0,1);u[0]=o[0]*M,u[1]=o[1]*M,f[0]=t[0]+u[0],f[1]=t[1]+u[1],r.vec2.subtract(v,i,f);var h=r.vec2.dot(v,v),d=r.vec2.dot(c,c),m=r.vec2.dot(o,o),p=r.vec2.dot(u,u);return(p>d||p>m)&&(h=Number.MAX_VALUE),h}function P(t,n,r){void 0===r&&(r=0);for(var a=e.clamp(t,0,K),o=0;o<4;o++)n[r+o]=Math.floor(256*j(a*_[o]))}function U(t,n){void 0===n&&(n=0);for(var r=0,e=0;e<4;e++)r+=t[n+e]*z[e];return r}function j(t){return t-Math.floor(t)}function k(t,n,e,a,o){var c=t;0===t[11]?(a[0]=2/(n*c[0]),a[1]=2/(e*c[5]),a[2]=(1+c[12])/c[0],a[3]=(1+c[13])/c[5],r.vec2.set(o,0,1)):(a[0]=-2/(n*c[0]),a[1]=-2/(e*c[5]),a[2]=(1-c[8])/c[0],a[3]=(1-c[9])/c[5],r.vec2.set(o,1,0))}Object.defineProperty(n,"__esModule",{value:!0});var q=r.vec4f64.create(),D=r.vec2f64.create(),w=r.vec2f64.create(),B=r.vec2f64.create(),V=r.vec2f64.create(),F=r.vec2f64.create(),X=r.vec2f64.create(),G=function(){function t(t){this.message=t}return t.prototype.toString=function(){return"AssertException: "+this.message},t}();n.AssertException=G,n.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"},n.assert=a,n.verify=o,n.encodeInt16=c,n.encodeNormal=i,n.fallbackIfUndefined=u,n.hex2rgb=f,n.rgb2hex=v,n.dec2hex=s,n.rayTriangle3D=l,n.rayBoxTest=M,n.rayRay2D=h,n.project=d,n.getFirstObjectKey=m,n.getFirstObjectValue=p,n.objectEmpty=g,n.logWithBase=x,n.setMatrixTranslation=y,n.setMatrixTranslation3=O,n.getMatrixTranslation=b,n.createTranslationMatrix=A,n.isTranslationMatrix=E,n.fovx2fovy=S,n.fovy2fovx=I,n.fovx2fovd=N,n.fovy2fovd=R,n.fovd2fovx=T,n.fovd2fovy=C,n.pointLineSegmentDistanceSquared2D=L,n.packFloatRGBA=P,n.unpackFloatRGBA=U;var _=[1,256,65536,16777216],z=[1/256,1/65536,1/16777216,1/4294967296],K=U(new Uint8ClampedArray([255,255,255,255]));n.inverseProjectionInfo=k});