// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.10/esri/copyright.txt for details.

define(["require","exports","../../core/tsSupport/declareExtendsHelper","../../core/tsSupport/decorateHelper","dojo/i18n!./ActionPad/nls/resources","../../core/Collection","../../core/Handles","../../core/lang","../../core/watchUtils","../../core/accessorSupport/decorators","../../widgets/Widget","./ActionPad/ActionPadViewModel","../../widgets/support/widget"],function(t,e,i,n,o,c,s,r,a,l,d,p,u){"use strict";var h={base:"esri-action-pad",section:"esri-action-pad__section",action:"esri-action-pad__action",actionIcon:"esri-action-pad__action-icon",actionIconImage:"esri-action-pad__action-icon--image",actionTitle:"esri-action-pad__action-title",selectionCount:"esri-action-pad__selection-count",selectionCountNumber:"esri-action-pad__selection-count-number",text:"esri-icon-font-fallback-text",esriWidget:"esri-widget"},g={actionsSections:"actionsSections",actions:"actions",allActions:"allActions"};return function(t){function e(e){var i=t.call(this)||this;return i._handles=new s,i.expandEnabled=!1,i.iconClass="",i.label=o.widgetLabel,i.selectionCount=0,i.viewModel=new p,i}return i(e,t),e.prototype.postInitialize=function(){var t=this;this.own([a.init(this,"viewModel.actionsSections",function(){return t._watchActionsSections()}),a.on(this,"viewModel.actionsSections","change",function(){return t._watchActionsSections()})])},e.prototype.render=function(){var t=this.selectionCount,e=r.substitute({selectionCount:t},o.selectionCount),i=t?u.tsx("div",{class:h.section},u.tsx("div",{title:e,"aria-label":e,class:h.selectionCount},u.tsx("span",{class:h.selectionCountNumber},t))):null;return u.tsx("div",{class:this.classes(h.base,h.esriWidget)},this._renderActionsSections(),i)},e.prototype._watchActions=function(t,e){var i=this,n=this._handles,o=g.actions+"-"+e;n.remove(o),t&&t.forEach(function(t){var e=a.watch(t,["id","className","title","image","visible"],function(){return i.scheduleRender()});n.add(e,o),n.add(e,g.allActions)})},e.prototype._watchActionsSections=function(){var t=this;this.scheduleRender();var e=this,i=e._handles,n=e.actionsSections;i.remove(g.actionsSections),n.forEach(function(e,n){var o=e.on("change",function(){t.scheduleRender(),t._watchActions(e,n)});i.add(o,g.actionsSections),t._watchActions(e,n)})},e.prototype._renderActionsSections=function(){var t=this,e=this.actionsSections;if(e&&c.isCollection(e))return e.map(function(e){return u.tsx("div",{class:h.section},t._renderActions(e))}).toArray()},e.prototype._renderActions=function(t){var e=this;if(t&&c.isCollection(t))return t.map(function(t){return e._renderAction(t)}).filter(Boolean).toArray()},e.prototype._getActionImage=function(t){if("slider"!==t.type)return t.image},e.prototype._renderAction=function(t){var e,i;if(t){var n=t.title,o=t.className,c=t.visible,s=this._getActionImage(t),r=(e={},e[h.actionIconImage]=!!s,e);if(c){var a=this.expandEnabled,l=(i={},i[h.text]=!a,i);return u.tsx("div",{key:t,role:"button",tabIndex:0,title:n,"aria-label":n,class:h.action,bind:this,"data-action":t,onclick:this._triggerAction,onkeydown:this._triggerAction},u.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes(h.actionIcon,o,r),styles:this._getIconStyles(s)}),u.tsx("span",{key:"text",class:this.classes(h.actionTitle,l)},n))}}},e.prototype._getIconStyles=function(t){return{"background-image":t?"url("+t+")":""}},e.prototype._triggerAction=function(t){var e=t.currentTarget&&t.currentTarget["data-action"];e&&this.viewModel.triggerAction(e)},n([u.renderable(),l.aliasOf("viewModel.actionsSections")],e.prototype,"actionsSections",void 0),n([u.renderable(),l.property()],e.prototype,"expandEnabled",void 0),n([l.property({readOnly:!0})],e.prototype,"iconClass",void 0),n([l.property({readOnly:!0})],e.prototype,"label",void 0),n([u.renderable(),l.property()],e.prototype,"selectionCount",void 0),n([l.property(),u.renderable(["viewModel.actionsSections"]),u.vmEvent(["triggerAction","trigger-action"])],e.prototype,"viewModel",void 0),n([u.accessibleHandler()],e.prototype,"_triggerAction",null),e=n([l.subclass("esri.widgets.ActionPad")],e)}(l.declared(d))});