// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.10/esri/copyright.txt for details.

define(["require","exports","../../core/tsSupport/declareExtendsHelper","../../core/tsSupport/decorateHelper","dojo/i18n!../../nls/common","dojo/i18n!./ActionBar/nls/resources","../../core/Collection","../../core/Handles","../../core/watchUtils","../../core/accessorSupport/decorators","../../widgets/Widget","./ActionBar/ActionBarViewModel","../../widgets/support/widget"],function(t,e,n,i,o,a,s,c,r,l,d,p,u){"use strict";var h={base:"esri-action-bar",section:"esri-action-bar__section",action:"esri-action-bar__action",actionIcon:"esri-action-bar__action-icon",actionIconImage:"esri-action-bar__action-icon--image",actionTitle:"esri-action-bar__action-title",expandButton:"esri-action-bar__expand-button",expandButtonIcon:"esri-action-bar__expand-button-icon",expandButtonTitle:"esri-action-bar__expand-button-title",text:"esri-icon-font-fallback-text",expandIcon:"esri-icon-expand",collapseIcon:"esri-icon-collapse",esriWidget:"esri-widget"},g={actionsSections:"actionsSections",actions:"actions",allActions:"allActions"};return function(t){function e(e){var n=t.call(this)||this;return n._handles=new c,n.expandEnabled=!1,n.iconClass="",n.label=a.widgetLabel,n.viewModel=new p,n}return n(e,t),e.prototype.postInitialize=function(){var t=this;this.own([r.init(this,"viewModel.actionsSections",function(){return t._watchActionsSections()}),r.on(this,"viewModel.actionsSections","change",function(){return t._watchActionsSections()})])},e.prototype.render=function(){var t,e=this.expandEnabled,n=(t={},t[h.expandIcon]=e,t[h.collapseIcon]=!e,t),i=e?o.collapse:o.expand,a=u.tsx("div",{class:this.classes(h.section,h.expandButton),key:"expandButton",role:"button",tabIndex:0,"aria-label":i,title:i,bind:this,onclick:this._toggleExpandEnabled,onkeydown:this._toggleExpandEnabled},u.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes(h.expandButtonIcon,n)}),u.tsx("span",{key:"label",class:this.classes(h.expandButtonTitle,h.text)},i));return u.tsx("div",{class:this.classes(h.base,h.esriWidget)},this._renderActionsSections(),a)},e.prototype._watchActions=function(t,e){var n=this,i=this._handles,o=g.actions+"-"+e;i.remove(o),t&&t.forEach(function(t){var e=r.watch(t,["id","className","title","image","visible"],function(){return n.scheduleRender()});i.add(e,o),i.add(e,g.allActions)})},e.prototype._watchActionsSections=function(){var t=this;this.scheduleRender();var e=this,n=e._handles,i=e.actionsSections;n.remove(g.actionsSections),i.forEach(function(e,i){var o=e.on("change",function(){t.scheduleRender(),t._watchActions(e,i)});n.add(o,g.actionsSections),t._watchActions(e,i)})},e.prototype._renderActionsSections=function(){var t=this,e=this.actionsSections;if(e&&s.isCollection(e))return e.map(function(e){return u.tsx("div",{class:h.section},t._renderActions(e))}).toArray()},e.prototype._renderActions=function(t){var e=this;if(t&&s.isCollection(t))return t.map(function(t){return e._renderAction(t)}).filter(Boolean).toArray()},e.prototype._getActionImage=function(t){if("slider"!==t.type&&"toggle"!==t.type)return t.image},e.prototype._renderAction=function(t){var e,n;if(t){var i=t.title,o=t.className,a=t.visible,s=this._getActionImage(t),c=(e={},e[h.actionIconImage]=!!s,e);if(a){var r=this.expandEnabled,l=(n={},n[h.text]=!r,n);return u.tsx("div",{key:t,role:"button",tabIndex:0,title:i,"aria-label":i,class:h.action,bind:this,"data-action":t,onclick:this._triggerAction,onkeydown:this._triggerAction},u.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes(h.actionIcon,o,c),styles:this._getIconStyles(s)}),u.tsx("span",{key:"text",class:this.classes(h.actionTitle,l)},i))}}},e.prototype._getIconStyles=function(t){return{"background-image":t?"url("+t+")":""}},e.prototype._toggleExpandEnabled=function(){this.expandEnabled=!this.expandEnabled},e.prototype._triggerAction=function(t){var e=t.currentTarget&&t.currentTarget["data-action"];this.viewModel.triggerAction(e)},i([u.renderable(),l.aliasOf("viewModel.actionsSections")],e.prototype,"actionsSections",void 0),i([u.renderable(),l.property()],e.prototype,"expandEnabled",void 0),i([l.property({readOnly:!0})],e.prototype,"iconClass",void 0),i([l.property({readOnly:!0})],e.prototype,"label",void 0),i([l.property(),u.renderable(["viewModel.actionsSections"]),u.vmEvent(["triggerAction","trigger-action"])],e.prototype,"viewModel",void 0),i([u.accessibleHandler()],e.prototype,"_toggleExpandEnabled",null),i([u.accessibleHandler()],e.prototype,"_triggerAction",null),e=i([l.subclass("esri.widgets.ActionBar")],e)}(l.declared(d))});