// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.10/esri/copyright.txt for details.

define(["require","exports","@dojo/framework/shim/Set","../../core/object","./domains"],function(e,n,i,r,l){function a(e,i){if(null!=e&&null!=i)for(var r=0,l=Array.isArray(e)?e:[e];r<l.length;r++){var a=l[r];if(t(n.rendererFields,a,i),"visualVariables"in a&&a.visualVariables)for(var o=0,u=a.visualVariables;o<u.length;o++){var s=u[o];t(n.visualVariableFields,s,i)}}}function t(e,n,i){if(e)for(var l=0,a=e;l<a.length;l++){var t=a[l],u=r.getDeepValue(t,n),s=u&&"function"!=typeof u&&o(u,i);s&&r.setDeepValue(t,s.name,n)}}function o(e,n){if("string"!=typeof e)return null;if(null!=n){e=e.toLowerCase();for(var i=0,r=n;i<r.length;i++){var l=r[i];if(l&&l.name.toLowerCase()===e)return l}}return null}function u(e){var n=e.defaultValue;return void 0!==n&&y(e,n)?n:e.nullable?null:void 0}function s(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function d(e){return null===e||s(e)}function f(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function c(e){return null===e||f(e)}function g(e){return null!=e&&"string"==typeof e}function m(e){return null===e||g(e)}function p(e){return!0}function y(e,n){var i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?c:f;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?d:s;break;case"string":case"esriFieldTypeString":i=e.nullable?m:g;break;default:i=p}return 1===arguments.length?i:i(n)}function F(e){return null!=e&&_.has(e.type)}function v(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function b(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}function V(e,n){return null===I(e,n)}function T(e){return null==e?null:e}function I(e,n){return e.nullable&&null===n?null:F(e)&&!D(e.type,n)?h.OUT_OF_RANGE:y(e,n)?e.domain?l.validateDomainValue(e.domain,n):null:A.INVALID_TYPE}function D(e,n){var i=N(e);return!!i&&(n>=i.min&&n<=i.max)}function E(e){var n=l.getDomainRange(e.domain);if(n)return n;if(F(e))return N(e.type)}function N(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return n.smallIntegerRange;case"esriFieldTypeInteger":case"integer":return n.integerRange;case"esriFieldTypeSingle":case"single":return n.singleRange;case"esriFieldTypeDouble":case"double":return n.doubleRange}}function R(e,n,i){switch(e){case l.DomainValidationError.INVALID_CODED_VALUE:return"Value "+i+" is not in the coded domain - field: "+n.name+", domain: "+JSON.stringify(n.domain);case l.DomainValidationError.VALUE_OUT_OF_RANGE:return"Value "+i+" is out of the range of valid values - field: "+n.name+", domain: "+JSON.stringify(n.domain);case A.INVALID_TYPE:return"Value "+i+" is not a valid value for the field type - field: "+n.name+", type: "+n.type+", nullable: "+n.nullable;case h.OUT_OF_RANGE:var r=N(n.type),a=r.min,t=r.max;return"Value "+i+" is out of range for the number type - field: "+n.name+", type: "+n.type+", value range is "+a+" to "+t}}Object.defineProperty(n,"__esModule",{value:!0}),n.fixRendererFields=a,n.getField=o,n.getFieldDefaultValue=u,n.isValueMatchingFieldType=y,n.rendererFields=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],n.visualVariableFields=["field","normalizationField"],n.numericTypes=["integer","small-integer","single","double"];var _=new i.default(n.numericTypes.concat(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]));n.isNumericField=F,n.isStringField=v,n.isDateField=b,n.isValidFieldValue=V;var h;!function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"}(h=n.NumericRangeValidationError||(n.NumericRangeValidationError={}));var A;!function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(A=n.TypeValidationError||(n.TypeValidationError={})),n.sanitizeNullFieldValue=T,n.validateFieldValue=I,n.isNumberInRange=D,n.getFieldRange=E,n.smallIntegerRange={min:-32768,max:32767},n.integerRange={min:-2147483648,max:2147483647},n.singleRange={min:-3.4e38,max:1.2e38},n.doubleRange={min:-Number.MAX_VALUE,max:Number.MAX_VALUE},n.validationErrorToString=R});