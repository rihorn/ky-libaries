// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.10/esri/copyright.txt for details.

define(["require","exports","../../geometry","../../Graphic","../../core/compilerUtils","../../core/lang","../../geometry/SpatialReference","../../geometry/support/aaBoundingBox","../../geometry/support/aaBoundingRect","../../geometry/support/quantizationUtils","../support/Field","../../views/3d/support/buffer/typedArrayUtil","./dehydratedFeatureComparison"],function(e,t,r,a,n,s,i,o,l,u,p,h,c){function m(e){return"point"===e.type}function y(e){var t=r.featureGeometryTypeKebabDictionary.fromJSON(e.geometryType),a=i.fromJSON(e.spatialReference),s=e.transform,o=e.features.map(function(r){var i=f(r,t,a,e.objectIdFieldName),o=i.geometry;if(o&&s)switch(o.type){case"point":i.geometry=u.hydratePoint(s,o,o,o.hasZ,o.hasM);break;case"multipoint":i.geometry=u.hydrateMultipoint(s,o,o,o.hasZ,o.hasM);break;case"polygon":i.geometry=u.hydratePolygon(s,o,o,o.hasZ,o.hasM);break;case"polyline":i.geometry=u.hydratePolyline(s,o,o,o.hasZ,o.hasM);break;default:n.neverReached(o)}return i});return{geometryType:t,features:o,spatialReference:a,fields:e.fields?e.fields.map(function(e){return p.fromJSON(e)}):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function f(e,t,r,n){return{uid:a.generateUID(),objectId:n&&e.attributes?e.attributes[n]:null,attributes:e.attributes,geometry:d(e.geometry,t,r),visible:!0}}function d(e,t,r){if(!e)return null;switch(t){case"point":var a=e,n={x:a.x,y:a.y,z:a.z,m:a.m,hasZ:null!=a.z,hasM:null!=a.m,type:t,spatialReference:r};return n;case"polyline":var s=e,n={paths:s.paths,hasZ:!!s.hasZ,hasM:!!s.hasM,type:t,spatialReference:r};return n;case"polygon":var i=e,n={rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:t,spatialReference:r};return n;case"multipoint":var o=e,n={points:o.points,hasZ:!!o.hasZ,hasM:!!o.hasM,type:t,spatialReference:r};return n}}function g(e,t,r,a){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:a,type:"point"}}function x(e){return"declaredClass"in e}function b(e){return"declaredClass"in e}function v(e,t){if(!e||b(e))return e;var r=new a({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=s.clone(e.symbol),r.attributes=s.clone(e.attributes),e.geometry&&("mesh"===e.geometry.type?r.geometry=e.geometry:r.read({geometry:N(e.geometry)})),r}function M(e){if(!e)return null;if(x(e))return e.clone();var t=g(e.x,e.y,e.z,e.spatialReference);return e.hasM&&(t.m=e.m,t.hasM=!0),t}function Z(e){for(var t=32,r=0,a=Object.keys(e.attributes);r<a.length;r++){var n=a[r];t+=n.length;var s=e.attributes[n];switch(typeof s){case"string":t+=s.length;break;default:case"number":t+=8}}return t+12*(e.geometry?"mesh"===e.geometry.type?0:R(e.geometry):0)}function R(e){if(!e)return 0;switch(e.type){case"point":return 1;case"polyline":for(var t=0,r=0,a=e.paths;r<a.length;r++){t+=a[r].length}return t;case"polygon":for(var t=0,s=0,i=e.rings;s<i.length;s++){t+=i[s].length}return t;case"multipoint":return e.points.length;case"extent":return 2;case"mesh":var o=e.vertexAttributes&&e.vertexAttributes.position;return o?o.length/3:0;default:n.neverReached(e)}}function A(e){if(!e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(var t=0,r=e.paths;t<r.length;t++){if(r[t].length>0)return!0}return!1;case"polygon":for(var a=0,s=e.rings;a<s.length;a++){if(s[a].length>0)return!0}return!1;case"multipoint":return e.points.length>0;case"mesh":return e.vertexAttributes&&e.vertexAttributes.position&&e.vertexAttributes.position.length>0;default:n.neverReached(e)}}function N(e){var t=e.spatialReference.toJSON();switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:t};case"polygon":var r=e.rings,a=e.hasZ,s=e.hasM;return{rings:z(r),hasZ:a,hasM:s,spatialReference:t};case"polyline":var i=e.paths,a=e.hasZ,s=e.hasM;return{paths:z(i),hasZ:a,hasM:s,spatialReference:t};case"extent":var o=e.xmin,l=e.xmax,u=e.ymin,p=e.ymax,h=e.zmin,c=e.zmax,m=e.mmin,y=e.mmax,a=e.hasZ,s=e.hasM;return{xmin:o,xmax:l,ymin:u,ymax:p,zmin:h,zmax:c,mmin:m,mmax:y,hasZ:a,hasM:s,spatialReference:t};case"multipoint":var f=e.points,a=e.hasZ,s=e.hasM;return{points:w(f)?k(f):f,hasZ:a,hasM:s,spatialReference:t};default:n.neverReached(e)}}function z(e){if(F(e))return e.map(function(e){return k(e)})}function k(e){return e.map(function(e){return h.toArray(e)})}function F(e){for(var t=0,r=e;t<r.length;t++){var a=r[t];if(0!==a.length)return w(a)}return!1}function w(e){return e.length&&(h.isFloat32Array(e[0])||h.isFloat64Array(e[0]))}function B(e,t){switch(o.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(var r=0;r<e.paths.length;r++)o.expandWithNestedArray(t,e.paths[r],e.hasZ);break;case"polygon":for(var r=0;r<e.rings.length;r++)o.expandWithNestedArray(t,e.rings[r],e.hasZ);break;case"multipoint":o.expandWithNestedArray(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax);break;default:n.neverReached(e)}}function P(e,t){B(e,I),o.expand(t,I)}function S(e,t){switch(l.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(var r=0;r<e.paths.length;r++)l.expandWithNestedArray(t,e.paths[r]);break;case"polygon":for(var r=0;r<e.rings.length;r++)l.expandWithNestedArray(t,e.rings[r]);break;case"multipoint":l.expandWithNestedArray(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax;break;default:n.neverReached(e)}}function O(e,t){S(e,j),l.expand(t,j)}Object.defineProperty(t,"__esModule",{value:!0}),t.equals=c.equals,t.isPoint=m,t.fromFeatureSetJSON=y,t.fromJSONGeometry=d,t.makeDehydratedPoint=g,t.isHydratedGeometry=x,t.isHydratedGraphic=b,t.hydrateGraphic=v,t.clonePoint=M,t.estimateSize=Z,t.numVertices=R,t.hasVertices=A,t.computeAABB=B,t.expandAABB=P,t.computeAABR=S,t.expandAABR=O;var I=o.create(),j=l.create()});