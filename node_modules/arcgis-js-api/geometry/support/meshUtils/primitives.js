// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.10/esri/copyright.txt for details.

define(["require","exports","../../../core/libs/gl-matrix-2/gl-matrix","./georeference"],function(r,a,e,n){function t(){for(var r=u.faceDescriptions,a=u.faceVertexOffsets,e=u.uvScales,n=4*r.length,t=new Float64Array(3*n),o=new Float32Array(3*n),i=new Float32Array(2*n),s=new Uint32Array(2*r.length*3),f=0,v=0,l=0,c=0,h=0;h<r.length;h++){for(var p=r[h],w=f/3,g=0,m=a;g<m.length;g++){var y=m[g];s[c++]=w+y}for(var x=p.corners,A=0;A<4;A++){var M=x[A],d=0;i[l++]=.25*e[A][0]+p.uvOrigin[0],i[l++]=p.uvOrigin[1]-.25*e[A][1];for(var O=0;O<3;O++)0!==p.axis[O]?(t[f++]=.5*p.axis[O],o[v++]=p.axis[O]):(t[f++]=.5*M[d++],o[v++]=0)}}return{position:t,normal:o,uv:i,faces:s}}function o(r){void 0===r&&(r=0);for(var a=Math.round(8*Math.pow(2,r)),e=2*a,n=(a-1)*(e+1)+2*e,t=new Float64Array(3*n),o=new Float32Array(3*n),i=new Float32Array(2*n),s=(a-1)*e*2,f=new Uint32Array(3*s),v=0,l=0,c=0,u=0,p=0,w=0;w<=a;w++){var g=w/a*Math.PI+.5*Math.PI,m=Math.cos(g),y=Math.sin(g);h[2]=y;for(var x=0===w||w===a,A=x?e-1:e,M=0;M<=A;M++){var d=M/A*2*Math.PI;h[0]=-Math.sin(d)*m,h[1]=Math.cos(d)*m;for(var O=0;O<3;O++)t[v++]=.5*h[O],o[l++]=h[O];i[c++]=(M+(x?.5:0))/e,i[c++]=w/a,0!==w&&M!==e&&(w!==a&&(f[u++]=p,f[u++]=p+1,f[u++]=p-e),1!==w&&(f[u++]=p,f[u++]=p-e,f[u++]=p-e-1)),p++}}return{position:t,normal:o,uv:i,faces:f}}function i(r){void 0===r&&(r=0);for(var a=Math.round(16*Math.pow(2,r)),e=4*(a+1)+2*a,n=new Float64Array(3*e),t=new Float32Array(3*e),o=new Float32Array(2*e),i=4*a,s=new Uint32Array(3*i),f=0,v=0,l=0,c=0,u=0,p=0;p<=5;p++)for(var w=0===p||5===p,g=p<=1||p>=4,m=2===p||4===p,y=w?a-1:a,x=0;x<=y;x++){var A=x/y*2*Math.PI,M=w?0:.5;h[0]=M*Math.sin(A),h[1]=M*-Math.cos(A),h[2]=p<=2?.5:-.5;for(var d=0;d<3;d++)n[f++]=h[d],t[v++]=g?2===d?p<=1?1:-1:0:2===d?0:h[d]/M;o[l++]=(x+(w?.5:0))/a,o[l++]=p<=1?1*p/3:p<=3?1*(p-2)/3+1/3:1*(p-4)/3+2/3,m||0===p||x===a||(5!==p&&(s[c++]=u,s[c++]=u+1,s[c++]=u-a),1!==p&&(s[c++]=u,s[c++]=u-a,s[c++]=u-a-1)),u++}return{position:n,normal:t,uv:o,faces:s}}function s(r){for(var a=c.facingAxisOrderSwap[r],e=c.position,n=c.normal,t=new Float64Array(e.length),o=new Float32Array(n.length),i=0,s=0;s<4;s++)for(var f=i,v=0;v<3;v++){var l=a[v],u=Math.abs(l)-1,h=l>=0?1:-1;t[i]=e[f+u]*h,o[i]=n[f+u]*h,i++}return{position:t,normal:o,uv:new Float32Array(c.uv),faces:new Uint32Array(c.faces)}}function f(r,a,e){v(r),l(r,e&&e.size);var t=n.georeference(r,a,e);return{vertexAttributes:{position:t.position,normal:t.normal,uv:r.uv},components:[{faces:r.faces,material:e&&e.material||null}],spatialReference:a.spatialReference}}function v(r){for(var a=0;a<r.position.length;a+=3)r.position[a+2]+=.5}function l(r,a){if(null!=a){var n="number"==typeof a?[a,a,a]:[null!=a.width?a.width:1,null!=a.depth?a.depth:1,null!=a.height?a.height:1];p[0]=n[0],p[4]=n[1],p[8]=n[2];for(var t=0;t<r.position.length;t+=3){for(var o=0;o<3;o++)h[o]=r.position[t+o];e.vec3.transformMat3(h,h,p);for(var o=0;o<3;o++)r.position[t+o]=h[o]}if(n[0]!==n[1]||n[1]!==n[2]){p[0]=1/n[0],p[4]=1/n[1],p[8]=1/n[2];for(var t=0;t<r.normal.length;t+=3){for(var o=0;o<3;o++)h[o]=r.normal[t+o];e.vec3.transformMat3(h,h,p),e.vec3.normalize(h,h);for(var o=0;o<3;o++)r.normal[t+o]=h[o]}}}}Object.defineProperty(a,"__esModule",{value:!0}),a.createUnitSizeBox=t,a.createUnitSizeSphere=o,a.createUnitSizeCylinder=i,a.createUnitSizePlane=s;var c={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[3,1,2],west:[-3,-1,2],north:[-1,3,2],south:[1,-3,2],up:[1,2,3],down:[1,-2,-3]}};a.convertUnitGeometry=f;var u={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]};a.boxFaceOrder={south:0,east:1,north:2,west:3,up:4,down:5};var h=e.vec3f64.create(),p=e.mat3f64.create()});